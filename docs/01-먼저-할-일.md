# 01. 먼저 할 일 (첫 설정 체크리스트)

Onecation Client Portal을 처음 켜기 전에 아래 순서대로 진행하세요.

---

## 1. Node.js 버전

- **Node 20 LTS** 사용을 권장합니다. Node 22에서는 `npm run dev` 시 **`require is not defined`** 오류가 날 수 있습니다.
- **Node 22 사용 중인데 위 오류가 났다면** → [02-Node22-오류-해결.md](02-Node22-오류-해결.md) 참고해 Node 20으로 전환하세요.
- 터미널에서 확인: `node -v`

---

## 2. 의존성 설치

```bash
npm install
```

- 설치 후 `npm audit`으로 취약점이 나오면 **`npm audit fix`** 실행해서 패치된 버전으로 올리세요. (Next.js 등)

---

## 3. 환경 변수 설정

1. 프로젝트 루트의 **`.env.local.example`** 파일을 복사해서 **`.env.local`** 로 이름 변경
2. `.env.local` 안에 아래 세 값을 Supabase에서 복사해 넣기

```env
NEXT_PUBLIC_SUPABASE_URL=https://xxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGc...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGc...
```

- Supabase Dashboard → **Project Settings** → **API** 에서 확인
- **`.env.local`을 수정했다면 반드시 `npm run dev`를 끄고 다시 실행**하세요. 그렇지 않으면 로그인 시 **"Failed to fetch"** 오류가 날 수 있습니다.

---

## 4. Supabase SQL 실행 (순서 지키기)

Supabase Dashboard → **SQL Editor** 에서 **아래 순서대로** 실행:

| 순서 | 경로 | 설명 |
|------|------|------|
| 1 | `supabase/sql/01-schema/schema.sql` | 테이블·RLS·트리거 |
| 2 | `supabase/sql/02-storage/storage.sql` | reports, assets 버킷 |
| 3 | `supabase/sql/03-seed/seed.sql` | 데모 클라이언트 + KPI (선택) |
| 4 | `supabase/sql/03-seed/profiles.sql` | 프로필 등록 (Auth 사용자 생성 후, 여러 번 실행 가능) |

자세한 내용은 `supabase/sql/README.md` 참고.

---

## 5. Auth 사용자 생성

Supabase Dashboard → **Authentication** → **Users** → **Add user** → **Create new user**

Admin·테스트 등 필요한 계정을 만드세요. 이메일은 자유롭게 지정 가능합니다.

| 용도 | Email | UUID (Auth에서 확인) |
|------|--------|----------------------|
| Admin | `yeomjw0907@naver.com` | `9b54abfa-7692-48a3-804d-bec6b977181d` |
| 테스트(클라이언트) | `test1@naver.com` | `ebf05114-6c34-4c20-b25f-d31496c24541` |

위 이메일로 Auth 사용자를 만든 뒤, **6번**에서 `profiles.sql` 실행.

---

## 6. 프로필 등록 (DB)

SQL Editor에서 **`supabase/sql/03-seed/profiles.sql`** 전체를 붙여 넣고 실행하세요.

- 기존 admin/test 프로필을 지운 뒤 위 UUID·이메일로 다시 넣습니다.
- **여러 번 실행해도 됩니다** (회원정보 바꿀 때마다 다시 실행 가능).
- Admin: `client_id` NULL, `role` = admin.
- 테스트: 데모 클라이언트 `c0000000-0000-0000-0000-000000000001` 연결.

---

## 7. 앱 실행

```bash
npm run dev
```

브라우저에서 `http://localhost:3000` 접속.

- **Admin**: 이메일 `yeomjw0907@naver.com` + 비밀번호  
- **테스트(클라이언트)**: 이메일 `test1@naver.com` + 비밀번호  

로그인 필드에 **이메일 전체**를 넣거나, 클라이언트 코드만 넣으면 됩니다 (코드만 넣으면 `코드@onecation.client`로 변환).

---

## 체크리스트 요약

- [ ] Node 20 설치/사용
- [ ] `npm install` 완료
- [ ] `.env.local` 에 Supabase URL·Anon Key·Service Role Key 설정
- [ ] `01-schema/schema.sql` 실행
- [ ] `02-storage/storage.sql` 실행
- [ ] Auth에 admin(yeomjw0907@naver.com), test(test1@naver.com) 사용자 생성
- [ ] `03-seed/profiles.sql` 실행
- [ ] (선택) `03-seed/seed.sql` 실행
- [ ] `npm run dev` 로 로그인·화면 확인

여기까지 완료하면 첫 번째로 할 일은 끝입니다. 추가 문서는 `docs/` 폴더에 번호 붙여서 요청하시면 정리해 드리겠습니다.
