# 02. Node 22에서 "require is not defined" 오류 해결

`npm run dev` 실행 시 아래 오류가 나면 Node 22와 Next.js 호환 문제입니다.  
(설정만으로는 해결되지 않아, **Node 20 사용**을 권장합니다.)

```
ReferenceError: require is not defined
.next\server\pages\_document.js
```

**해결: Node 20 LTS를 설치하고 이 프로젝트에서만 Node 20을 사용하세요.**

- **Node 24 LTS**도 있을 수 있음. Node 24는 22보다 나중 버전이라, Next.js가 만드는 번들에 따라 **같은 `require is not defined` 오류가 날 수도 있고**, 안 날 수도 있음. **한번 `nvm use 24` 후 `npm run dev` 해보고**, 오류 나면 Node 20 쓰면 됨.

---

## 방법 A: Node 20 직접 설치 (가장 단순)

1. [https://nodejs.org](https://nodejs.org) 접속
2. **LTS(20.x)** 버전 다운로드 후 설치
3. 설치 후 터미널을 새로 열고 `node -v` → `v20.x.x` 확인
4. 프로젝트 폴더에서 다시 `npm run dev`

기존 Node 22는 설치 프로그램으로 제거하거나, 아래 nvm으로 버전 전환해 사용할 수 있습니다.

---

## 방법 B: nvm-windows로 Node 20 사용

1. **nvm for Windows** 설치  
   - [nvm-windows 릴리스](https://github.com/coreybutler/nvm-windows/releases)에서 `nvm-setup.exe` 다운로드 후 실행
2. 터미널(관리자 권장)에서:
   ```bash
   nvm install 20
   nvm use 20
   ```
3. `node -v` → `v20.x.x` 확인
4. 프로젝트 폴더에서 `npm run dev`

이후 이 프로젝트 쓸 때마다 `nvm use 20` 한 번 실행하면 됩니다. 프로젝트 루트에 `.nvmrc`에 `20`이 있으면 `nvm use`만 해도 됩니다.

---

## 정리

| 상황 | 조치 |
|------|------|
| Node 22 사용 중, `require is not defined` 발생 | Node 20 LTS 사용 (가장 확실함) |
| Node 24 LTS만 있음 | `npm run dev` 먼저 실행해 보기. 같은 오류 나면 Node 20 설치 후 `nvm use 20` |
| nvm 사용 중 | `nvm install 20` → `nvm use 20` 후 `npm run dev` |

Node 20으로 전환하면 `npm run dev`가 정상 동작합니다.

---

## 다른 프로젝트는 Node 22 그대로 써도 되나요?

**네.** Node 20을 "시스템 기본"으로 바꾸지 않고 쓰면 됩니다.

- **nvm 사용 시 (권장)**  
  Node 20과 22를 **둘 다 설치**해 두고, 터미널에서 프로젝트마다만 바꿉니다.
  - 이 프로젝트(원마케팅 SaaS): `nvm use 20` → Node 20
  - 다른 프로젝트: `nvm use 22` 또는 그냥 사용 → Node 22  
  → **다른 프로젝트는 계속 Node 22로 실행해도 됩니다.**

- **Node 20만 직접 설치한 경우**  
  설치 시 "PATH에 추가"를 선택하면, 그때부터 터미널 기본이 Node 20이 될 수 있습니다.  
  그렇게 되면 Node 22 쓰던 다른 프로젝트는 `node -v`가 20으로 나와서, 22가 꼭 필요한 프로젝트는 영향 받을 수 있습니다.  
  → **여러 버전을 같이 쓰려면 nvm으로 20/22 둘 다 두고 전환하는 방식이 안전합니다.**
