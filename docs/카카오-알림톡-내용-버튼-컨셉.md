# 카카오 알림톡 · 내용·버튼 컨셉 (비즈니스 오너 관점)

알림톡에서 **어떤 내용을 제공할지**, **버튼은 무엇을 넣을지**, **없는 것은 무엇인지**를 정리한 문서입니다.  
템플릿 등록 문구는 [카카오-알림톡-템플릿-등록-예시.md](./카카오-알림톡-템플릿-등록-예시.md), 필요 템플릿 목록은 [카카오-알림톡-필요-템플릿-리스트.md](./카카오-알림톡-필요-템플릿-리스트.md)를 참고하세요.

---

## 0. 알림톡 링크 = 매직링크 (필수 원칙)

**알림톡에 넣는 모든 링크는 매직링크로 처리한다.** 사용자가 클릭하면 **로그인 없이** 바로 해당 대시보드/보고서/승인 화면으로 이동해야 한다.

- **이유**: 수신자가 로그인 화면에서 멈추면 이탈이 크고, "바로 보기" 경험이 서비스 인상에 직결됨.
- **구현**: URL에 **토큰(또는 서명)**을 넣고, 해당 토큰으로 리소스(보고서/주간 알림/승인 등)를 식별·만료 시간을 검사한 뒤, 로그인 없이 콘텐츠를 노출.
- **현재 구현**  
  - 월/수/목 "자세히 보기": `/report/v/{viewToken}` (토큰으로 주간 알림 조회, 로그인 불필요)  
  - 월/수/목 "승인하기": `/report/approve/{approvalToken}` (토큰으로 승인 처리, 로그인 불필요)
- **구현 시 유의**  
  - **보고서 발행** 링크: `/reports/:id`처럼 세션 의존 경로 대신, 보고서용 view token을 발급해 `/report/v/:token` 또는 전용 경로로 직행하도록 설계.  
  - **실행 현황/일정** 등: 고정 URL이 아니라 토큰 기반 매직링크를 쓸 경우, 해당 리소스별 view token 발급·만료 정책을 맞춰야 함.

---

## 1. 비즈니스 오너 관점: 서비스가 잘 되려면 알림톡에서 뭘 해야 하나

**핵심 가치**: 고객(광고주)이 "우리 광고를 잘 챙겨주는 서비스"라고 느끼고, **알림만 봐도 핵심을 알 수 있어야** 하고, **클릭하면 바로 그 자리로 가야** 함.

| 목표 | 알림톡이 해야 할 일 |
|------|---------------------|
| 이탈 방지·재방문 | 제목만이 아니라 **한 줄 브리프/요약**을 넣어 "뭔지 모르겠어서 안 열기"를 줄인다. |
| 신뢰·전문성 | 월/수/목처럼 **규칙적인 터치** + **AI 요약**으로 "데이터 기반으로 챙겨준다"는 인상을 준다. |
| 전환(클릭·승인) | 버튼은 **해당 콘텐츠로 직행**하는 링크여야 한다. 목록보다 **상세/해당 항목** 링크가 좋다. |
| 관리 효율 | 관리자용(addon)은 "누가·무엇·얼마"만 명확하면 됨. |

**냉철한 결론**

- **보고서 발행**: 지금은 "제목 + 목록 링크"뿐이라 약함. **브리프(한 줄 요약)** 가 들어가야 "뭔 내용인지" 보이고 클릭률이 올라감. 이 브리프는 **AI 요약**이어야 함.
- **월/수/목**: 이미 AI 요약 있음. 유지.
- **실행·일정**: 현재는 목록 링크. 당장 필수는 아니고, 여유 있을 때 "해당 항목 바로가기" 추가하면 UX 상승.

---

## 2. 템플릿별 제공 내용 컨셉

| 템플릿 | 목적 | 제공하는 내용 | 수신자 |
|--------|------|----------------|--------|
| **TPL_welcome** | 가입 승인 완료 (웰컴) | 고객명, 대시보드 매직링크 | 고객 |
| **TPL_report_published** | 보고서 발행 알림 | 고객명, 리포트 제목, **AI 브리프**, 보고서 매직링크 | 고객 |
| **TPL_action_status** | 실행 항목 상태 변경 | 고객명, 작업명, 이전/현재 상태 | 고객 |
| **TPL_event_reminder** | 일정 리마인더 | 고객명, 일정명, 일정 날짜 | 고객 |
| **TPL_mon_review** | 매주 월요일 정기 | 고객명, AI 요약(지난주 성과), 토큰 URL "자세히 보기" | 고객 |
| **TPL_wed_budget** | 매주 수요일 정기 | 고객명, AI 요약(예산 페이싱), 토큰 URL "자세히 보기" | 고객 |
| **TPL_thu_proposal** | 매주 목요일 정기 + 승인 유도 | 고객명, AI 요약(다음 주 제안), 자세히 보기 URL, 승인 전용 URL | 고객 |
| **TPL_addon_order_admin** | 부가서비스 주문 접수 (관리자) | 고객명, 서비스명, 금액, 관리자 주문 목록 링크 | 관리자 |
| **TPL_addon_order_client** | 부가서비스 주문 접수 확인 (고객) | 고객명, 서비스명, 금액 | 고객 |
| **TPL_password_reset** | 비밀번호 재설정(추후) | 고객명, 재설정 페이지 링크 | 고객 |

요약: **고객용**은 "무슨 일이 있음 + 링크로 바로 가기", **관리자용(addon)** 은 "누가 무엇을 얼마에 주문했음 + 확인 링크"가 컨셉입니다.

### 보고서 브리프 = AI 요약 (필수 개선)

- 보고서 발행 알림에 **한 줄 브리프**를 넣어야 "뭔 내용인지" 보이고 클릭률이 올라감.
- 브리프는 **AI 요약**이어야 함: 리포트 제목+본문(summary)을 입력으로, 50자 내외 한 줄 요약 생성 (월/수/목 `getAiMessageForReport`와 유사).
- 템플릿에 변수 `#{브리프}` 추가, 발송 시 AI 결과 또는 본문 앞 50자 폴백으로 채움.
- 동시에 **해당 보고서 상세 링크**를 **매직링크**(토큰 URL)로 보내야 함. 로그인 없이 바로 해당 보고서로 직행. (현재는 `/reports` 목록만 전달 중. 구현 시 보고서별 view token 발급 후 `/report/v/:token` 등으로 직행하도록 할 것.)

---

## 3. 버튼 현황 (있는 것 / 없는 것)

### 버튼 정리 (목표 상태)

| 템플릿 | 버튼 | 링크 | 비고 |
|--------|------|------|------|
| TPL_welcome | 1개: 대시보드 바로가기 | `#{링크}` (매직링크) | 동적 링크 O |
| TPL_report_published | 1개: 보고서 확인하기 | `#{링크}` (보고서 매직링크) | 동적 링크 O |
| TPL_action_status | 1개: 실행 현황 보기 | `#{링크}` (매직링크) | 동적 링크 O |
| TPL_event_reminder | 1개: 일정 보기 | `#{링크}` (매직링크) | 동적 링크 O |
| TPL_mon_review | 1개: 자세히 보기 | `#{자세히보기}` (토큰 URL) | 동적 링크 O |
| TPL_wed_budget | 1개: 자세히 보기 | `#{자세히보기}` (토큰 URL) | 동적 링크 O |
| TPL_thu_proposal | 2개: 자세히 보기, 승인하기 | `#{자세히보기}`, `#{승인하기}` | 동적 링크 O |
| TPL_addon_order_admin | 1개: 주문 확인 | `#{링크}` (관리자 주문 목록) | 동적 링크 O |
| TPL_addon_order_client | 1개: 주문 내역 보기 | `#{링크}` (매직링크) | 동적 링크 O |
| TPL_password_reset | 1개: 비밀번호 설정 | `#{링크}` | 동적 링크 O |

모든 템플릿에 **최소 1개 버튼**은 있음. 카카오 "최소 1개 버튼" 요건 충족.

### 없는 것 / 선택 사항

- **채널 추가 / 상담하기 / 전화하기**: 현재 어느 템플릿에도 없음. 필요하면 특정 템플릿(예: 고객용 마지막에 "문의는 채널 추가" 등)에만 추가 가능. 알림톡은 정보 전달용이므로 "채널 추가"는 선택.
- **실행 항목/일정 딥링크**  
  - **TPL_action_status**: 지금은 "실행 현황 보기"로 **목록(overview)** 만 연결. 특정 실행 항목 상세 URL을 넣으려면 코드에서 `viewUrl` 같은 변수를 추가하고, 템플릿에 버튼 1개 더(예: "해당 작업 보기")를 넣는 방식이 필요.  
  - **TPL_event_reminder**: "일정 보기"는 **타임라인 목록** 연결. 특정 일정 상세 URL이 필요하면 변수·버튼 추가 필요.
- **TPL_password_reset**: 앱에서 아직 호출하지 않음. 나중에 비밀번호 리셋 플로우 연동 시 그대로 사용 가능.

---

## 4. 수신 거부 안내 (필수)

모든 고객용 알림톡 본문 하단에 아래 문구를 넣는다:

> 알림 수신을 원하지 않으시면 카카오톡 채널을 차단해 주세요.

- 카카오 심사에서 수신 거부 방법 안내가 없으면 반려될 수 있음.
- 알림톡은 정보성 메시지이므로 별도 opt-out 링크 대신 채널 차단 안내로 충분.

---

## 5. 발송 시간 (확정)

| 요일 | 템플릿 | 발송 시간 (KST) | 이유 |
|------|--------|-----------------|------|
| 월요일 | TPL_mon_review | 09:30 | 출근 직후, 지난주 성과 체크 타이밍 |
| 수요일 | TPL_wed_budget | 14:00 | 오후 업무 중, 예산 점검 타이밍 |
| 목요일 | TPL_thu_proposal | 16:00 | 퇴근 전, 다음 주 제안 검토·승인 유도 |
| 비정기 | TPL_report_published 등 | 관리자 발송 시점 | 보고서 발행·상태 변경 등은 이벤트 기반 |

Vercel Cron에 위 시간을 설정할 것. 새벽·심야 발송은 절대 금지.

---

## 6. AI 요약 톤 통일

| 템플릿 | AI 페르소나 | 톤 |
|--------|------------|-----|
| TPL_mon_review | 긍정적인 마케팅 분석가 | 칭찬·격려, 이모지 1개 가능 |
| TPL_wed_budget | 냉철한 예산 관리자 | 건조하게 팩트만 |
| TPL_thu_proposal | 신중한 전략가 | 안전한 제안, 무리한 증액 금지 |
| TPL_report_published (브리프) | 간결한 보고서 요약가 | 핵심 한 줄, 50자 이내, 감정 최소 |

서비스 전체 알림톡 톤이 일관되어야 브랜드 인상이 통일됨.

---

## 7. 토큰 만료 시 안내 페이지

매직링크 토큰이 만료(viewToken 7일, approvalToken 3일)되었을 때, 에러가 아니라 **"링크가 만료되었습니다. 로그인하여 확인해 주세요."** 안내 페이지를 보여줘야 함.

- 구현: `/report/v/:token` 조회 시 만료면 전용 만료 안내 페이지로 리다이렉트 또는 인라인 표시.
- 로그인 버튼 포함해서 이탈을 최소화.

---

## 8. 나중에 하고 싶을 때

- **실행 항목/일정 딥링크**: 해당 항목 상세 URL을 변수로 넘기고, 버튼 링크를 그 변수로 설정하면 됨.
- **채널 추가 버튼**: 카카오 알림톡 버튼 유형 중 "채널 추가" 선택 후 등록.
- **보고서 브리프**: 위 "보고서 브리프 = AI 요약" 절차대로 템플릿 변수 추가 + AI 요약 함수 + 발송 로직 연동.
- **승인 확인 알림**: 고객이 목요일 제안 승인 시 "승인되었습니다" 확인 알림톡. 웹에서 피드백이 충분하면 선택.
